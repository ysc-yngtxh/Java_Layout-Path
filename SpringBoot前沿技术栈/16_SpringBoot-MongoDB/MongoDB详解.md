
## 一、简介
 ### 1.简单介绍 
    MongoDB 是一个基于分布式文件存储的数据库,由 C++ 语言编写，旨在为 WEB 应用提供可扩展的高性能数据存储解决方案。  
    MongoDB是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。  
    它支持的数据结构非常松散，是类似json的bson格式，因此可以存储比较复杂的数据类型。  
    Mongo最大的特点是它支持的查询语言非常强大，其语法有点类似于面向对象的查询语言，几乎可以实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立索引

 ### 2.具体应用场景：

   > 社交场景，使用 MongoDB存储存储用户信息，以及用户发表的朋友圈信息，通过地理位置索引实现附近的人、地点等功能。  
   > 游戏场景，使用 MongoDB存储游戏用户信息，用户的装备、积分等直接以内嵌文档的形式存储，方便查询、高效率存储和访问。  
   > 物流场景，使用 MongoDB存储订单信息，订单状态在运送过程中会不断更新，以 MongoDB内嵌数组的形式来存储，一次查询就能将订单所有的变更读取出来  
   > 物联网场景，使用 MongoDB存储所有接入的智能设备信息，以及设备汇报的日志信息，并对这些信息进行多维度的分析。  
   > 视频直播，使用 MongoDB存储用户信息、点赞互动信息等。
   
 ### 3.这些应用场景中，数据操作方面的共同特点是：

    （1）数据量大
    （2）写入操作频繁（读写都很频繁）
    （3）价值较低的数据，对事务性要求不高

     对于这样的数据，我们更适合使用 MongoDB来实现数据的存储。

 ### 4.什么时候选择MongoDB
    （1）应用不需要事务及复杂join支持
    （2）新应用，需求会变，数据模型无法确定，想快速迭代开发
    （3）应用需要2000-3000以上的读写QPS（更高也可以）
    （4）应用需要TB甚至PB级别数据存储
    （5）应用要求存储的数据不丢失
    （6）应用需要99.999%高可用
    （7）应用需要大量的地理位置查询、文本查

 ### 4. 体系机构

   |  SQL术语/概念 |   MongoDB术语/概念 | 解释/说明                       |
   |:------------:|:----------------:|:---------------------------------:
   |   database   |     database     | 数据库                         
   |    table     |    collection    | 数据库表/集合                     
   |     row      |     document     | 数据记录行/文档                    
   |    column    |      field       | 数据字段/域                      
   |    index     |      index       | 索引                          
   | table joins  |                  | 表连接，MongoDB 不支持             
   |              |       嵌入文档    | MongoDB 通过嵌入式文档来替代多表连接      
   | primary key  |   primary key    | 主键，MongoDB 自动将_id 字段设置为主键   

 ### 6. 特点
     1. 高性能
        MongoDB提供高性能的数据持久性。特别是，对嵌入式数据模型的支持减少了数据库系统上I/O活动。
        索引支持更快的查询，并且可以包含来自嵌入式文档和数组的键。（文本索引解决搜索的需求、TTL索引解决历史数据自动过期的需求、地理位置索引可用于构建各种O2O应用）
        mmapv1、 wiredtiger、 mongorocks（ rocks）、 In-memory等多引擎支持满足各种场景需求
        Gridfs解决文件存储的需求
     
     2. 高可用性
        MongoDB的复制工具称为副本集（ replica set），它可提供自动故障转移和数据冗余
     
     3. 高扩展性
        MongoDB提供了水平可扩展性作为其核心功能的一部分。
        分片将数据分布在一组集群的机器上。（海量数据存储，服务能力水平扩展）
        从3.4开始，MoηgoDB支持基于片键创建数据区域。在一个平衡的集群中， MongoDB将一个区域所覆盖的读写只定向到该区域内的那些片。
     
     4. 丰富的查询支持
        MongoDB支持丰富的査询语言，支持读和写操作（CRUD），比如数据聚合、文本搜索和地理空间查询等
     
     5. 其他特点
        如无模式（动态模式）、灵活的文档模型


## 二、基本常用命令
      1. 数据库相关
         # 查看所有数据库
         show databases
         # 选择数据库(如果数据库不存在,不会报错;会隐式创建:当后期该数据库有数据时自动创建)
         use 数据库名
         # 删除数据库(先选中数据库)
         db.dropDatabase()

      2. 集合相关
         # 查看所有集合
         show collections
         # 创建集合(插入数据会隐式创建)
         db.createCollection('集合名')
         # 删除集合
         db.集合名.drop()

## 三、CURD 
### <figure>增：插入文档</figure>
- >  ###### 语法：db.集合名.insert(json数据)
- >  ###### db.myCollection.insert({"name":"Rousi","age":27,city:"perpro"})

      集合存在则直接插入数据，不存在则隐式创建集合并插入数据。  
      json数据格式要求key得加""，但这里为了方便查看，对象的key统一不加""；  
      查看集合数据时系统会自动给key加""mongodb会自动给每条数据创建全球唯一的_id键（我们也可以自定义_id的值，只要给插入的json数据增加_id键即可覆盖，但是不推荐这样做）</figure>

### <figure>删：删除文档</figure>
- >  ###### 语法：db.集合名.remove(条件, [是否删除一条])
- >  ###### db.myCollection.remove({age:27}) 相当于 db.myCollection.remove({age:27}, false)

      # 是否删除一条。   
        - false删除多条,即全部删除(默认)；  
        - true删除一条

### <figure>改：修改文档</figure>
- >  ###### 语法：db.集合名.update(条件, 新数据 [是否新增, 是否修改多条])
- >  ###### db.myCollection.update({"age":27}, {"name":"Bob","age":27,city:"123"})
- >  ###### db.myCollection.update({"age":27}, {$rename: {"name":"bName"}})
      # 新数据
        - 默认是对原数据进行替换
        - 若要进行修改,格式为 {修改器:{key:value}}
      
      # 是否新增
        - 条件匹配不到数据时是否插入: true插入,false不插入(默认)
      
      # 是否修改多条
        - 条件匹配成功的数据是否都修改: true都修改,false只修改一条(默认)
   |    修改器   | 作用 
   |:----------:|:--------:
   |   $inc	    | 递增
   |  $rename	| 重命名列
   |   $set	    | 修改列值
   |  $unset	| 删除列

### <figure>查：查询文档</figure>
- >  ###### 语法：db.集合名.find(条件 [,查询的列])
- >  ###### 语法：db.集合名.find(条件 [,查询的列]).pretty()	#格式化查看
- >  ###### db.myCollection.find({age:{$gt:27}}, {name:1,age:0,city:2})

      # 条件
        - 查询所有数据	{}或不写
        - 查询指定要求数据	{key:value}或{key:{运算符:value}}
      
      # 查询的列(可选参数)
        - 不写则查询全部列
        - {key:1}	只显示key列
        - {key:0}	除了key列都显示
        - 注意:_id列都会存在
  | 运算符| 作用
  |:----:|:--------:
  | $gt  | 大于
  | $gte | 大于等于
  | $lt  | 小于
  | $lte | 小于等于
  | $ne  | 不等于
  | $in  | in
  | $nin | not in

## 四、排序&分页

### <figure>排序</figure>
- >  ###### 语法：db.集合名.find().sort(json数据)
- >  ###### db.myCollection.find({age:27}).sort({age:1})

      # json数据(key:value)
        - key就是要排序的字段
        - value为1表示升序,-1表示降序

### <figure>分页</figure>
- >  ###### 语法：db.集合名.find().sort().skip(数字).limit(数字)[.count()]
- >  ###### db.myCollection.find({}).skip(1).limit(3)

      # skip(数字)
        - 指定跳过的数量(可选)
      
      # limit(数字)
        - 限制查询的数量

      # count()
        - 统计数量

## 五、聚合查询
- >  ###### 语法：db.集合名.aggregate([{管道:{表达式}} ... ])

  | 常用管道 | 用途
  |:------:|---------------------------
  | $group | 将集合中的文档分组，用于统计结果
  | $match | 过滤数据，只输出符合条件的文档
  | $sort  | 聚合数据进一步排序
  | $skip  | 跳过指定文档数
  | $limit | 限制集合数据返回文档数
  |  $sum  | 总和（$num:1同count表示统计）
  |  $avg  | 平均
  |  $min  | 最小值
  |  $max  | 最大值

